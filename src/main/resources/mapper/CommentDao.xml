<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wang.dao.CommentDao">

    <resultMap id="ThisEntity" type="com.wang.entity.Comment">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="blog_id" jdbcType="INTEGER" property="blogId"/>
        <result column="commentator" jdbcType="VARCHAR" property="commentator"/>
        <result column="email" jdbcType="VARCHAR" property="email"/>
        <result column="content" jdbcType="VARCHAR" property="content"/>
        <result column="add_time" jdbcType="TIMESTAMP" property="addTime"/>
        <result column="reply" jdbcType="VARCHAR" property="reply"/>
        <result column="reply_time" jdbcType="TIMESTAMP" property="replyTime"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
        <result column="deleted" jdbcType="INTEGER" property="deleted"/>
    </resultMap>

    <select id="getTotal" resultType="int">
        select count(id) from comment
        where deleted=0
    </select>

    <select id="getList" resultMap="ThisEntity" parameterType="com.wang.util.PageQuery">
        select * from comment
        where deleted=0
        <if test="pageQuery.blogId!=0">
            and blog_id = #{pageQuery.blogId}
        </if>
        <if test="pageQuery.status==1">
            and status=1
        </if>
        order by id asc
        <if test="pageQuery.isTotal==null">
            limit #{pageQuery.start},#{pageQuery.pageSize}
        </if>
    </select>

    <update id="deleteOrCheck">
        update comment
        <set>
            <if test="deleteOrCheck==0">
                deleted=1,
            </if>

            <if test="deleteOrCheck==1">
              status=1
            </if>
        </set>
        where id in
        <foreach item="id" collection="ids"  open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

    <update id="reply">
        update comment
        set reply=#{reply} where id=#{id}
    </update>

    <insert id="add" parameterType="com.wang.entity.Comment">
        insert into comment(id, blog_id, commentator, email, content, add_time, reply, reply_time, status, deleted)
        values (null,#{comment.blogId},#{comment.commentator},#{comment.email},#{comment.content},now(),null,null,0,0)
    </insert>

</mapper>